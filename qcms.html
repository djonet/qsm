<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>الأسئلة - Qcms BY DJO</title>

<!-- 🔒 حماية الصفحة عبر Firebase -->
<script type="module">
  import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBldr32JPJGdMyZZBT1PD2eHvE48QkVtU8",
    authDomain: "qcm-djo.firebaseapp.com",
    projectId: "qcm-djo",
    storageBucket: "qcm-djo.firebasestorage.app",
    messagingSenderId: "384943172069",
    appId: "1:384943172069:web:6b59c1b9b31f2fe097a70c",
    measurementId: "G-13MC1GT4HM"
  };

  // إخفاء الصفحة مؤقتًا حتى يتم التحقق من الحساب
  document.documentElement.style.visibility = 'hidden';

  const app = getApps().length ? getApps()[0] : initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // 🔍 التحقق من صلاحية المستخدم في مجموعة allowedUsers
  onAuthStateChanged(auth, async (user) => {
    if (!user) {
      window.location.replace('index.html');
      return;
    }

    try {
      const ref = doc(db, 'allowedUsers', user.uid);
      const snap = await getDoc(ref);

      if (snap.exists()) {
        document.documentElement.style.visibility = 'visible';
      } else {
        window.location.replace('welcome.html?status=pending');
      }
    } catch (e) {
      console.error('فشل في قراءة بيانات Firebase:', e);
      window.location.replace('welcome.html?status=pending');
    }
  });
</script>

<style>
  @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Poppins:wght@600&display=swap');
  body {
    font-family: 'Cairo', Arial, sans-serif;
    direction: rtl;
    background: radial-gradient(circle at top, #d9faff, #aee4f5, #7fd4e8);
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    position: relative;
    overflow-y: auto;
    color: white;
  }
  .bg-illustration {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: url('A_2D_digital_illustration_login_and_registration_s.png') center/cover no-repeat;
    opacity: 0.06;
    z-index: 0;
  }
  .flag {
    position: absolute;
    top: 15px;
    left: 15px;
    width: 50px;
    border-radius: 5px;
  }
  .container {
    background: rgba(0, 0, 0, 0.55);
    padding: 30px;
    border-radius: 20px;
    backdrop-filter: blur(15px);
    box-shadow: 0 8px 30px rgba(0,0,0,0.7);
    width: 700px;
    max-width: 95%;
    z-index: 2;
    margin-bottom: 40px;
    text-align: center;
  }
  h2 {
    font-size: 26px;
    margin-bottom: 25px;
  }
  .button {
    display: inline-block;
    margin: 10px;
    padding: 12px 20px;
    background: linear-gradient(135deg, #1e1e1e, #2c2c2c);
    border: none;
    border-radius: 12px;
    color: white;
    font-size: 16px;
    cursor: pointer;
    transition: all 0.3s;
  }
  .button:hover {
    background: linear-gradient(135deg, #48cae4, #007b9e);
    transform: scale(1.05);
  }
  .logout {
    margin-top: 25px;
    color: #fff;
    opacity: 0.8;
    cursor: pointer;
    font-size: 14px;
  }
  .logout:hover {
    opacity: 1;
    text-decoration: underline;
  }
</style>
</head>

<body>
  <div class="bg-illustration"></div>
  <img src="https://upload.wikimedia.org/wikipedia/commons/7/77/Flag_of_Algeria.svg" class="flag" alt="علم الجزائر">

  <div class="container">
    <h2>المواد الدراسية للسنة الثانية - طب الأسنان</h2>
    <p>اختر المادة للوصول إلى الدروس والأسئلة:</p>

    <div class="subjects-list">
      <button class="button" onclick="goToSubject('Prothèse')">Prothèse</button>
      <button class="button" onclick="goToSubject('ODF')">ODF</button>
      <button class="button" onclick="goToSubject('Anatomie humaine')">Anatomie humaine</button>
      <button class="button" onclick="goToSubject('Anatomie dentaire')">Anatomie dentaire</button>
      <button class="button" onclick="goToSubject('Oce')">Oce</button>
      <button class="button" onclick="goToSubject('Parodontologie')">Parodontologie</button>
      <button class="button" onclick="goToSubject('Pathologie')">Pathologie</button>
      <button class="button" onclick="goToSubject('Microbiologie')">Microbiologie</button>
      <button class="button" onclick="goToSubject('immunologie')">Immunologie</button>
      <button class="button" onclick="goToSubject('histologie')">Histologie</button>
      <button class="button" onclick="goToSubject('physiologie')">Physiologie</button>
      <button class="button" onclick="goToSubject('biomateriaux')">Biomatériaux</button>
    </div>

    <div class="logout" onclick="logout()">🔒 تسجيل الخروج</div>
  </div>

<!-- 🔧 سكريبت الوظائف (خارج الموديول لتعمل مع onclick) -->
<script>
  function goToSubject(subject) {
    localStorage.setItem('subject', subject);
    localStorage.setItem('specialty', 'طب الأسنان');
    localStorage.setItem('level', 'سنة 2');
    window.location.href = 'lessons.html';
  }

  function logout() {
    import("https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js").then(({ getAuth, signOut }) => {
      const auth = getAuth();
      signOut(auth).then(() => {
        localStorage.clear();
        window.location.href = 'index.html';
      });
    });
  }
</script>

</body>
</html>
